\chapter{APIs del Sistema}
\label{anx:apis}

En este anexo incluimos la definición de todas las APIs de los microservicios del sistema. Esto incluye los \foreign{english}{endponts} HTTP, las notificaciones y las peticiones asíncronas.

\section{Monitorización}

????? ????????????? ????????????? ????????????? ????????????? ?????????????

\section{Conocimiento}

????? ????????????? ????????????? ????????????? ????????????? ?????????????

\section{Análisis}

????? ????????????? ????????????? ????????????? ????????????? ?????????????

\section{Planificador}

????? ????????????? ????????????? ????????????? ????????????? ?????????????

\section{Anexo: Docker compose}

En el fragmento \ref{ls:docker-compose-example} mostramos la declaración de la configuración de un servicio. En las líneas 4

Podemos apreciar que nos permite declarar las dependencias entre servicios (líneas 12-13). Esto fue clave para el despliegue del contenedor de \texttt{RabbitMQ}. Debido a que el protocolo requiere de una conexión permanente al bus\cite{johanssonPartRabbitMQBest2019}, todos los servicios que dependen de él deben desplegarse después. Por ello, declaramos una dependencia con este servicio y definimos una política de reintentos (línea 18).

\begin{lstlisting}[style=yaml,caption={Ejemplo de declaración de despliegue de un servicio en Docker Compose},captionpos=b, label=ls:docker-compose-example]
climatisation_rules:
build:
  context: ./climatisation_rules
  args:
    ANALYSISSERVICE_SERVICEURI: "http://analysis:80"
    BUSCONFIGURATION_SERVICEURI: "amqp://user:password@rabbitmq"
    GRAFANA_LOKI_URI: "http://loki:3100"
    JAEGER_HOST: "jaeger"
    JAEGER_PORT: "6831"
environment:
  ASPNETCORE_ENVIRONMENT: "Production"
depends_on:
  - rabbitmq
ports:
  - "9001:80"
networks:
  - analysis-network
restart: on-failure:5
  \end{lstlisting}
